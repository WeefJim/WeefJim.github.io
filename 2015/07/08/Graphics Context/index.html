<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Graphics Context | Optional Stack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="简介图形上下文（Graphics Context），就是你向系统申请提供给你绘制图形的地方。iOS开发中有多种方式来获取图形上下文。以下我将介绍3种获取图形上下文的方法和2套在图形上下文上绘制图形的工具">
<meta property="og:type" content="article">
<meta property="og:title" content="Graphics Context">
<meta property="og:url" content="http://www.jinyejun.com/2015/07/08/Graphics Context/index.html">
<meta property="og:site_name" content="Optional Stack">
<meta property="og:description" content="简介图形上下文（Graphics Context），就是你向系统申请提供给你绘制图形的地方。iOS开发中有多种方式来获取图形上下文。以下我将介绍3种获取图形上下文的方法和2套在图形上下文上绘制图形的工具">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Graphics Context">
<meta name="twitter:description" content="简介图形上下文（Graphics Context），就是你向系统申请提供给你绘制图形的地方。iOS开发中有多种方式来获取图形上下文。以下我将介绍3种获取图形上下文的方法和2套在图形上下文上绘制图形的工具">
  
    <link rel="alternative" href="/atom.xml" title="Optional Stack" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="https://avatars0.githubusercontent.com/u/11286317?v=3&amp;s=460" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">YeJun Jim</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Push, Pop, Never Overflow</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/WeefJim" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/p/1005053761334171/home?from=page_100505&mod=TAB#place" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="/app.jinyejun@gmail.com" title="mail">mail</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/app_jinyejun"#"" title="twitter">twitter</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://optionalswift.cn">团队博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">ios开发菜鸟一只，求轻虐</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">YeJun Jim</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://avatars0.githubusercontent.com/u/11286317?v=3&amp;s=460" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">YeJun Jim</h1>
			</hgroup>
			
			<p class="header-subtitle">Push, Pop, Never Overflow</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/WeefJim" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/p/1005053761334171/home?from=page_100505&mod=TAB#place" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="/app.jinyejun@gmail.com" title="mail">mail</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/app_jinyejun"#"" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Graphics Context" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/08/Graphics Context/" class="article-date">
  	<time datetime="2015-07-08T08:14:24.000Z" itemprop="datePublished">2015-07-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Graphics Context
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介">简介</h2><p>图形上下文（Graphics Context），就是你向系统申请提供给你绘制图形的地方。iOS开发中有多种方式来获取图形上下文。以下我将介绍3种获取图形上下文的方法和2套在图形上下文上绘制图形的工具</p>
<a id="more"></a>
<h2 id="如何获取图形上下文">如何获取图形上下文</h2><p>以下我会介绍三种获取图形上下文的方法： ①利用UIGraphicsBeginImageContextWithOptions来申请图形上下文，利用UIGraphicsGetImageFromCurrentImageContext来获取在图形上下文中绘制的图形（image），获取图片后释放图形上下文（Graphics Context）UIGraphicsEndImageContext。②当你继承UIView，重写drawRect:方法的时候，Cocoa框架已经为你自动申请了图形上下文，你在drawRect:方法中绘制的图形都会显示在你继承的UIView子类上。③另外如果你想对UIView的图层（layer）进行绘制，那么你可以继承CALayer子类，实现方法drawInContext:或者你可以使一些对象成为layer的委托者，来实现drawLayer:inContext:方法</p>
<h2 id="三种方式的联系与区别">三种方式的联系与区别</h2><ul>
<li>方法一，利用UIGraphicsBeginImageContextWithOptions的方法创建的图形上下文是当前图形上下文,可以利用UIGraphicsGetCurrentImageContext获取到UIGraphicsBeginImageContextWithOptions创建的图形上下文。</li>
<li>方法二，当drawRect方法被调用的时候，UIView进行绘制的图形上下文早就已经是当前图形上下文了。</li>
<li>方法三，回调方法drawLayerInContext或者drawLayer:inContext中的参数context，并不是当前图形上下文。</li>
</ul>
<h2 id="如何在图形上下文上绘制图形">如何在图形上下文上绘制图形</h2><p>这里将介绍两套绘制图形的工具。一套是UIKit中的绘制工具，另外一套就是Core Graphics。</p>
<font color="green">UIKit</font>

<p>像UIImage， NSString（绘制文本），UIBeizerPath（绘制形状），UIColor都知道如何绘制自己。这些类提供的功能有限但是使用方便。一般情况下，UIKit足够满足我们所需了。</p>
<p>使用UIKit，你只能在当前上下文中绘图，所以如果你当前处于UIGraphicsBeginImageContextWithOptions后或者drawRect:方法中，你就可以直接使用UIKit提供的方法进行绘图。如果你持有一个context参数，那么你在使用UIKit进行绘图之前，必须将该上下文参数转化为当前上下文。幸运的是，调用UIGraphicsPushContext函数可以方便的将context参数转化为当前上下文，最后记得用UIGraphicsPopContext恢复上下文环境。</p>
<font color="green">Core Graphics</font>

<p>这是一个绘图专用的API族，它经常被称为Quartz或者Quartz 2D。Core Graphics是iOS所有绘图功能的基石，贴近于底层，是由C函数构成的底层绘图API。其中UIKit也是在Core Graphics之上的一层封装。</p>
<p>使用Core Graphics之前需要制定一个用于绘图的图形上的下文（CGContextRef）,这个图形上下文会在绘图函数中都被用到。如果你持有一个图形上下文context参数，那么你就等同于拥有这个而图形上下文，这个上下文或许就是你需要用来绘图的那个，如果你利用UIGraphicsBeginImageContextWithOptions函数来申请图形上下文，那么你可以利用UIGraphicsGetCurrentContext来获取图形上下文的引用。</p>
<h2 id="绘图实践">绘图实践</h2><p>上文我们介绍了3中获取图形上下文的方法以及2套绘制图形的工具，这样组合起来一共就有6中绘制图形并且获得图形的方法了。以下我将以绘制一个红色轮廓线，蓝色填充的圆为例子，讲解所有绘制图形的组合方法。</p>
<ul>
<li>组合方法1 —— 利用drawRect的图形上下文，使用UIKit来绘制图形。</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 利用贝塞尔曲线构造圆形轮廓</span></span><br><span class="line">       <span class="keyword">let</span> ovalPath = <span class="type">UIBezierPath</span>(ovalInRect: rect)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条轮廓线宽度</span></span><br><span class="line">       ovalPath.lineWidth = <span class="number">2</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形轮廓线颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.redColor().setStroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形填充颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.blueColor().setFill()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 刻画圆形轮廓</span></span><br><span class="line">       ovalPath.stroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 填充圆形轮廓</span></span><br><span class="line">       ovalPath.fill()</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><ul>
<li>组合方法2 —— 利用drawRect的图形上下文，使用Core Graphics绘制图形</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 获取当前图形上下文</span></span><br><span class="line">       <span class="keyword">let</span> currentContext = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">   </span><br><span class="line">       <span class="comment">// 绘制圆形轮廓</span></span><br><span class="line">       <span class="type">CGContextAddEllipseInRect</span>(currentContext, rect)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置轮廓线宽度</span></span><br><span class="line">       <span class="type">CGContextSetLineWidth</span>(currentContext, <span class="number">2</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条颜色</span></span><br><span class="line">       <span class="type">CGContextSetStrokeColorWithColor</span>(currentContext, <span class="type">UIColor</span>.redColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置填充颜色</span></span><br><span class="line">       <span class="type">CGContextSetFillColorWithColor</span>(currentContext, <span class="type">UIColor</span>.blueColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 这里刻画圆形轮廓与填充圆形轮廓</span></span><br><span class="line">       <span class="type">CGContextDrawPath</span>(currentContext, kCGPathFillStroke)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// kCGPathFill表示用非零绕数规则</span></span><br><span class="line">       <span class="comment">// kCGPathEOFill表示用奇偶规</span></span><br><span class="line">       <span class="comment">// kCGPathFillStroke表示填充</span></span><br><span class="line">       <span class="comment">// kCGPathEOFillStroke表示描线，不是填充</span></span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><ul>
<li><p>组合方法3 —— 利用drawLayer:inContext的图形上下文，使用UIKit绘制图形 </p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawLayer</span><span class="params">(layer: CALayer!, inContext ctx: CGContext!)</span></span> &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// UIKit绘制，只能在当前图形上下文绘制</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 由于当前layer所处的context不是当前图形上下文</span></span><br><span class="line">       <span class="comment">// 需要将它push到context栈顶</span></span><br><span class="line">       <span class="type">UIGraphicsPushContext</span>(ctx)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 利用贝塞尔曲线构造圆形轮廓</span></span><br><span class="line">       <span class="keyword">let</span> ovalPath = <span class="type">UIBezierPath</span>(ovalInRect: layer.bounds)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条轮廓线宽度</span></span><br><span class="line">       ovalPath.lineWidth = <span class="number">2</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形轮廓线颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.redColor().setStroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形填充颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.blueColor().setFill()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 刻画圆形轮廓</span></span><br><span class="line">       ovalPath.stroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 填充圆形轮廓</span></span><br><span class="line">       ovalPath.fill()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 绘制完成，恢复上下文环境</span></span><br><span class="line">       <span class="type">UIGraphicsPopContext</span>()</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>组合方法4 —— 利用drawLayer:inContext的图形上下文，使用Core Graphics绘制图形</p>
   <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawLayer</span><span class="params">(layer: CALayer!, inContext ctx: CGContext!)</span></span> &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 所需要绘制的图形上下文就是ctx</span></span><br><span class="line">       <span class="type">CGContextAddEllipseInRect</span>(ctx, layer.bounds)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置轮廓线宽度</span></span><br><span class="line">       <span class="type">CGContextSetLineWidth</span>(ctx, <span class="number">2</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条颜色</span></span><br><span class="line">       <span class="type">CGContextSetStrokeColorWithColor</span>(ctx, <span class="type">UIColor</span>.redColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置填充颜色</span></span><br><span class="line">       <span class="type">CGContextSetFillColorWithColor</span>(ctx, <span class="type">UIColor</span>.blueColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 这里刻画圆形轮廓与填充圆形轮廓</span></span><br><span class="line">       <span class="type">CGContextDrawPath</span>(ctx, kCGPathFillStroke)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>组合方法5 —— 利用UIGraphicsBeginImageContextWithOptions的图形上下文，使用UIKit绘制图形</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">   </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 开启图形上下文，其中三个参数</span></span><br><span class="line">       <span class="comment">// size 所要绘制图形画布的大小</span></span><br><span class="line">       <span class="comment">// opaque 是否为不透明，如果true则绘制出来的图形背景色为黑色</span></span><br><span class="line">       <span class="comment">// scale 缩放比例，如果为0表示在单分辨率和2倍分辨率都可以很好的展现</span></span><br><span class="line">       <span class="type">UIGraphicsBeginImageContextWithOptions</span>(<span class="type">CGSizeMake</span>(<span class="number">100</span>, <span class="number">100</span>), <span class="built_in">false</span>, <span class="number">0</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 目前的图形上下文已经是当前图形上下文了</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 进行UIKit进行绘制</span></span><br><span class="line">       <span class="comment">// 利用贝塞尔曲线构造圆形轮廓</span></span><br><span class="line">       <span class="keyword">let</span> ovalPath = <span class="type">UIBezierPath</span>(ovalInRect: <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条轮廓线宽度</span></span><br><span class="line">       ovalPath.lineWidth = <span class="number">2</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形轮廓线颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.redColor().setStroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置圆形填充颜色</span></span><br><span class="line">       <span class="type">UIColor</span>.blueColor().setFill()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 刻画圆形轮廓</span></span><br><span class="line">       ovalPath.stroke()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 填充圆形轮廓</span></span><br><span class="line">       ovalPath.fill()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 绘制完成，从图形上下文中获取绘制的image</span></span><br><span class="line">       <span class="keyword">let</span> ovalImage = <span class="type">UIGraphicsGetImageFromCurrentImageContext</span>()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 结束绘制，释放图形上下文</span></span><br><span class="line">       <span class="type">UIGraphicsEndImageContext</span>()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 将图片显示在ImageView上</span></span><br><span class="line">       <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(image: ovalImage)</span><br><span class="line">       imageView.center = <span class="keyword">self</span>.view.center</span><br><span class="line">       <span class="keyword">self</span>.view.addSubview(imageView)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>组合方法6 —— 利用UIGraphicsBeginImageContextWithOptions的图形上下文，使用Core Graphics绘制图形</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">   </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 开启图形上下文，其中三个参数</span></span><br><span class="line">       <span class="comment">// size 所要绘制图形画布的大小</span></span><br><span class="line">       <span class="comment">// opaque 是否为不透明，如果true则绘制出来的图形背景色为黑色</span></span><br><span class="line">       <span class="comment">// scale 缩放比例，如果为0表示在单分辨率和2倍分辨率都可以很好的展现</span></span><br><span class="line">       <span class="type">UIGraphicsBeginImageContextWithOptions</span>(<span class="type">CGSizeMake</span>(<span class="number">100</span>, <span class="number">100</span>), <span class="built_in">false</span>, <span class="number">0</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// UIGraphicsBeiginImageContextWithOptions 方法开启的图形上下文是当前图形上下文</span></span><br><span class="line">       <span class="comment">// 通过 UIGraphicsGetCurrentContext 获取图形上下文的引用</span></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">let</span> currentContext = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 绘制圆形轮廓</span></span><br><span class="line">       <span class="type">CGContextAddEllipseInRect</span>(currentContext, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置轮廓线宽度</span></span><br><span class="line">       <span class="type">CGContextSetLineWidth</span>(currentContext, <span class="number">2</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置线条颜色</span></span><br><span class="line">       <span class="type">CGContextSetStrokeColorWithColor</span>(currentContext, <span class="type">UIColor</span>.redColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 设置填充颜色</span></span><br><span class="line">       <span class="type">CGContextSetFillColorWithColor</span>(currentContext, <span class="type">UIColor</span>.blueColor().<span class="type">CGColor</span>)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 这里刻画圆形轮廓与填充圆形轮廓</span></span><br><span class="line">       <span class="type">CGContextDrawPath</span>(currentContext, kCGPathFillStroke)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 绘制完成，从图形上下文中获取绘制的image</span></span><br><span class="line">       <span class="keyword">let</span> ovalImage = <span class="type">UIGraphicsGetImageFromCurrentImageContext</span>()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 结束绘制，释放图形上下文</span></span><br><span class="line">       <span class="type">UIGraphicsEndImageContext</span>()</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 将图片显示在ImageView上</span></span><br><span class="line">       <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(image: ovalImage)</span><br><span class="line">       imageView.center = <span class="keyword">self</span>.view.center</span><br><span class="line">       <span class="keyword">self</span>.view.addSubview(imageView)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><h2 id="总结">总结</h2><font color="green">UIKit</font>

<p>使用UIKit绘制图形，必须在当前图形上下文上（current context）上绘制。而使用UIGraphicsBeginImageContextWithOptions方法，开启的图形上下文便是当前图形上下文。如果在drawerLayer:inContext中使用UIKit，那么需要将context利用UIGraphicsPushContext到图形上下文栈顶，使之成为当前图形上下文。</p>
<font color="green">Core Graphics</font>

<p>使用Core Graphics绘制图形，必须获得图形上下文引用。如果在drawerLayer:InContext中绘制，那么context参数，便是图形上下文的引用。如果在drawRect方法中或者利用UIGraphicsBeginImageContextWithOptions开启的图形上下文中绘制图形，需要用UIGraphicsGetCurrentContext来获得对context的图形上下文的引用</p>
<h2 id="其他方法描述">其他方法描述</h2><ul>
<li>CGContextMoveToPoint 移动画笔到某个顶点作为起始顶点</li>
<li>CGContextAddLineToPoint 从起始顶点画一条直线到某个顶点</li>
<li>CGContextAddEllipseInRect 画一个矩形的内切圆</li>
<li>CGContextSetLineCap 设置线条终点形状</li>
<li>CGContextSetLineDash 函数画虚线</li>
<li>CGContextAddRect 增加一个矩形</li>
<li>CGContextStrokeRect 刻画矩形轮廓</li>
<li>CGContextStrokeRectWithWidth 指定轮廓线宽度刻画矩形轮廓</li>
<li>CGContextStrokeLineSegments 画直线段</li>
<li>CGContextAddArc 添加圆弧起始点</li>
<li>CGContextAddArcToPoint 先画两条线从point到第1点，从第1点到第2点的线切割里面的圆    </li>
<li>CGContextSetShadowWithColor 设置阴影</li>
<li>CGContextSetRGBFillColor 设置填充颜色RGB</li>
<li>CGContextSetRGBStrokeColor 设置画笔颜色</li>
<li>CGContextSetFillColorSpace 设置填充颜色空间</li>
<li>CGContextFillRect 填充一个矩形</li>
<li>CGContextSetAlpha 设置透明度</li>
<li>CGContextTranslateCTM 改变画布位置</li>
<li>CGContextSetLineWidth 设置画笔粗细</li>
<li>CGContextAddRects 画多个矩形</li>
<li>CGContextAddQuadCurveToPoint 画曲线</li>
<li>CGContextStrokePath 根据路径刻画</li>
<li>CGContextDrawPath 采用模式绘制图形</li>
<li>CGContextClosePath 封闭当前线路</li>
<li>CGContextSetInterpolationQuality 背景内置颜色质量等级</li>
<li>CGImageCreateWithImageInRect 从原图片中取小图</li>
<li>CGContextClosePath 封闭当前线路</li>
</ul>
<ul>
<li>字符串的 写入可用  NSString本身的画图方法</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drawInRect(rect: <span class="type">CGRect</span>, withAttributes attrs: [<span class="type">NSObject</span> : <span class="type">AnyObject</span>]?)</span><br><span class="line">drawAtPoint(point: <span class="type">CGPoint</span>, withAttributes attrs: [<span class="type">NSObject</span> : <span class="type">AnyObject</span>]?)</span><br></pre></td></tr></table></figure></span>
</code></pre><ul>
<li>对图片放大缩小的功能就是慢了点</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// newSize 放大/缩小后的图片大小</span></span><br><span class="line"><span class="type">UIGraphicsBeginImageContext</span>(newSize)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newImage = <span class="type">UIGraphicsGetImageFromCurrentImageContext</span>()</span><br><span class="line"></span><br><span class="line"><span class="type">UIGraphicsEndImageContext</span>()</span><br></pre></td></tr></table></figure></span>
</code></pre><ul>
<li><p>CGColorGetComponents（） 返回颜色的各个直 以及透明度 可用只读const float 来接收  是个数组</p>
</li>
<li><p>画图片</p>
</li>
</ul>
<pre><code><span class="comment"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> image＝<span class="type">CGImageRetain</span>(img.<span class="type">CGImage</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">10.0</span>, height - <span class="number">100.0</span>, <span class="number">90.0</span>, <span class="number">90.0</span>), image);</span><br></pre></td></tr></table></figure></span>
</code></pre><ul>
<li><p>实现逐变颜色填充方法 CGContextClip(context);</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rgb = <span class="type">CGColorSpaceCreateDeviceRGB</span>()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> colors: [<span class="type">CGFloat</span>] =</span><br><span class="line"></span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">       <span class="number">204.0</span> / <span class="number">255.0</span>, <span class="number">224.0</span> / <span class="number">255.0</span>, <span class="number">244.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</span><br><span class="line"></span><br><span class="line">       <span class="number">29.0</span> / <span class="number">255.0</span>, <span class="number">156.0</span> / <span class="number">255.0</span>, <span class="number">215.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</span><br><span class="line"></span><br><span class="line">       <span class="number">0.0</span> / <span class="number">255.0</span>,  <span class="number">50.0</span> / <span class="number">255.0</span>, <span class="number">126.0</span> / <span class="number">255.0</span>, <span class="number">1.00</span>,</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> gradient = <span class="type">CGGradientCreateWithColorComponents</span>(rgb, colors, <span class="type">NULL</span>, <span class="built_in">sizeof</span>(colors)/(<span class="built_in">sizeof</span>(colors[<span class="number">0</span>])*<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">   <span class="type">CGColorSpaceRelease</span>(rgb)  </span><br><span class="line"></span><br><span class="line">   <span class="type">CGContextDrawLinearGradient</span>(context, gradient,<span class="type">CGPointMake</span>(<span class="number">0.0</span>,<span class="number">0.0</span>) ,<span class="type">CGPointMake</span>(<span class="number">0.0</span>,<span class="keyword">self</span>.frame.size.height), kCGGradientDrawsBeforeStartLocation)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>注:  画完图后,必须 </p>
<blockquote>
<p>先用CGContextStrokePath来描线,即形状</p>
<p>后用CGContextFillPath来填充形状内的颜色. </p>
</blockquote>
<p>  填充一个路径的时候，路径里面的子路径都是独立填充的。假如是重叠的路径，决定一个点是否被填充，有两种规则</p>
<ol>
<li><p>nonzero winding number rule:非零绕数规则，假如一个点被从左到右跨过，计数器+1，从右到左跨过，计数器-1，最后，如果结果是0，那么不填充，如果是非零，那么填充。</p>
</li>
<li><p>even-odd rule: 奇偶规则，假如一个点被跨过，那么+1，最后是奇数，那么要被填充，偶数则不填充，和方向没有关系。</p>
</li>
</ol>
</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/07/08/UIImageView/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">UIImageView</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Graphics Context" data-title="Graphics Context" data-url="http://www.jinyejun.com/2015/07/08/Graphics Context/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>



</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 YeJun Jim
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>